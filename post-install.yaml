
---
- name: Post Install Steps
  hosts: all
  gather_facts: true
  become: True
  become_user: root
  tasks:
    - name: Set hostname
      ansible.builtin.hostname:
        name: k8s-master.example.com
        use: systemd

    - name: Add users
      ansible.builtin.user:
        name: "{{ item }}"
        state: present
      loop:
         - prayag
         - devops

    - name: Add user to sudoers
      lineinfile:
        dest: /etc/sudoers
        line: 'prayag ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s'

    - name: Installing packages
      ansible.builtin.apt: pkg={{ item }}
      loop:
        - python3
        - python3-pip
